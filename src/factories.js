/// <reference path="../../.tmp/typings/angularjs/angular.d.ts" />
/// <reference path="../../.tmp/typings/requirejs/require.d.ts" />
var Factory = require('rosie').Factory;
var faker = require('faker');
var angular = require('angular');
var smartFactory;
(function (smartFactory) {
    function config(factoryName) {
        return function (target) {
            target.__rosieFactoryName__ = factoryName;
            target.factory = {
                list: function (size, overrideObj) {
                    return Factory.buildList(target.__rosieFactoryName__, size, overrideObj);
                },
                build: function (overrideObj) {
                    return Factory.build(target.__rosieFactoryName__, overrideObj);
                }
            };
        };
    }
    smartFactory.config = config;
    var FakerWrapper = (function () {
        function FakerWrapper() {
        }
        FakerWrapper.findName = function () {
            return this.faker.name.findName();
        };
        FakerWrapper.faker = faker;
        return FakerWrapper;
    })();
    smartFactory.FakerWrapper = FakerWrapper;
    var FactoryWrapper = (function () {
        function FactoryWrapper() {
        }
        FactoryWrapper.define = function (name, constructor) {
            var fac = new FactoryWrapper();
            fac.wrappedFactory = this.factory.define(name, constructor);
            return fac;
        };
        FactoryWrapper.build = function (name, attributes, options) {
            return this.factory.build(name, attributes, options);
        };
        FactoryWrapper.buildList = function (name, size, attributes, options) {
            return this.factory.build(name, size, attributes, options);
        };
        FactoryWrapper.attributes = function (attributes, options) {
            return this.factory.attributes(attributes, options);
        };
        FactoryWrapper.options = function (options) {
            return this.factory.options(options);
        };
        FactoryWrapper.extend = function (name) {
            return this.factory.extend(name);
        };
        FactoryWrapper.for = function (target) {
            if ((target.__rosieFactoryName__) && (target.factory)) {
                return target.factory;
            }
            else {
                throw new Error('no factory registered for ' + target.toString() + ' please check!');
            }
        };
        FactoryWrapper.prototype.attr = function (name, dependenciesOrValue, value) {
            if (dependenciesOrValue && dependenciesOrValue.constructor === Array) {
                this.wrappedFactory = this.wrappedFactory.attr(name, dependenciesOrValue, value);
            }
            else {
                this.wrappedFactory = this.wrappedFactory.attr(name, [], dependenciesOrValue);
            }
            return this;
        };
        FactoryWrapper.prototype.sequence = function (name, dependencies, builder) {
            if (dependencies === undefined && builder === undefined) {
                this.wrappedFactory = this.wrappedFactory.sequence(name);
            }
            else if (dependencies === undefined) {
                this.wrappedFactory = this.wrappedFactory.sequence(name, [], builder || null);
            }
            else {
                this.wrappedFactory = this.wrappedFactory.sequence(name, dependencies, builder || null);
            }
            return this;
        };
        FactoryWrapper.factory = Factory;
        return FactoryWrapper;
    })();
    smartFactory.FactoryWrapper = FactoryWrapper;
    var Service = (function () {
        function Service() {
            return FactoryWrapper;
        }
        return Service;
    })();
    smartFactory.Service = Service;
})(smartFactory || (smartFactory = {}));
if ((typeof (angular) != 'undefined')) {
    angular.module('smartFactory', []).service('Factory', smartFactory.Service);
}
else {
    if (console && console.error) {
        if (typeof (angular) == 'undefined') {
            console.error('smartFactory not registered beacuse angular is missing');
        }
        if (typeof (faker) == 'undefined') {
            console.error('smartFactory not registered beacuse faker.js is missing');
        }
        if (typeof (Factory) == 'undefined') {
            console.error('smartFactory not registered beacuse angular rosie is missing');
        }
    }
}
module.exports = smartFactory;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImZhY3Rvcmllcy50cyJdLCJuYW1lcyI6WyJzbWFydEZhY3RvcnkiLCJzbWFydEZhY3RvcnkuY29uZmlnIiwic21hcnRGYWN0b3J5LkZha2VyV3JhcHBlciIsInNtYXJ0RmFjdG9yeS5GYWtlcldyYXBwZXIuY29uc3RydWN0b3IiLCJzbWFydEZhY3RvcnkuRmFrZXJXcmFwcGVyLmZpbmROYW1lIiwic21hcnRGYWN0b3J5LkZhY3RvcnlXcmFwcGVyIiwic21hcnRGYWN0b3J5LkZhY3RvcnlXcmFwcGVyLmNvbnN0cnVjdG9yIiwic21hcnRGYWN0b3J5LkZhY3RvcnlXcmFwcGVyLmRlZmluZSIsInNtYXJ0RmFjdG9yeS5GYWN0b3J5V3JhcHBlci5idWlsZCIsInNtYXJ0RmFjdG9yeS5GYWN0b3J5V3JhcHBlci5idWlsZExpc3QiLCJzbWFydEZhY3RvcnkuRmFjdG9yeVdyYXBwZXIuYXR0cmlidXRlcyIsInNtYXJ0RmFjdG9yeS5GYWN0b3J5V3JhcHBlci5vcHRpb25zIiwic21hcnRGYWN0b3J5LkZhY3RvcnlXcmFwcGVyLmV4dGVuZCIsInNtYXJ0RmFjdG9yeS5GYWN0b3J5V3JhcHBlci5mb3IiLCJzbWFydEZhY3RvcnkuRmFjdG9yeVdyYXBwZXIuYXR0ciIsInNtYXJ0RmFjdG9yeS5GYWN0b3J5V3JhcHBlci5zZXF1ZW5jZSIsInNtYXJ0RmFjdG9yeS5TZXJ2aWNlIiwic21hcnRGYWN0b3J5LlNlcnZpY2UuY29uc3RydWN0b3IiXSwibWFwcGluZ3MiOiJBQUFBLGtFQUFrRTtBQUNsRSxrRUFBa0U7QUFFbEUsSUFBSSxPQUFPLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDLE9BQU8sQ0FBQztBQUN2QyxJQUFJLEtBQUssR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7QUFFN0IsSUFBWSxPQUFPLFdBQU0sU0FBUyxDQUFDLENBQUE7QUFJbkMsSUFBTyxZQUFZLENBK0dsQjtBQS9HRCxXQUFPLFlBQVksRUFBQyxDQUFDO0lBRW5CQSxnQkFBdUJBLFdB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LEVBQUUsQ0FBQSxDQUFDLE9BQU8sSUFBSSxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUEsQ0FBQztRQUMzQixFQUFFLENBQUEsQ0FBQyxPQUFNLENBQUMsT0FBTyxDQUFDLElBQUksV0FBVyxDQUFDLENBQUEsQ0FBQztZQUMvQixPQUFPLENBQUMsS0FBSyxDQUFDLHdEQUF3RCxDQUFDLENBQUM7UUFDNUUsQ0FBQztRQUNELEVBQUUsQ0FBQSxDQUFDLE9BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxXQUFXLENBQUMsQ0FBQSxDQUFDO1lBQzdCLE9BQU8sQ0FBQyxLQUFLLENBQUMseURBQXlELENBQUMsQ0FBQztRQUM3RSxDQUFDO1FBQ0QsRUFBRSxDQUFBLENBQUMsT0FBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLFdBQVcsQ0FBQyxDQUFBLENBQUM7WUFDL0IsT0FBTyxDQUFDLEtBQUssQ0FBQyw4REFBOEQsQ0FBQyxDQUFDO1FBQ2xGLENBQUM7SUFDSCxDQUFDO0FBQ0gsQ0FBQztBQUVELGlCQUFTLFlBQVksQ0FBQyIsImZpbGUiOiJmYWN0b3JpZXMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vLi4vLnRtcC90eXBpbmdzL2FuZ3VsYXJqcy9hbmd1bGFyLmQudHNcIiAvPlxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uLy4uLy50bXAvdHlwaW5ncy9yZXF1aXJlanMvcmVxdWlyZS5kLnRzXCIgLz5cblxudmFyIEZhY3RvcnkgPSByZXF1aXJlKCdyb3NpZScpLkZhY3Rvcnk7XG52YXIgZmFrZXIgPSByZXF1aXJlKCdmYWtlcicpO1xuXG5pbXBvcnQgKiBhcyBhbmd1bGFyIGZyb20gJ2FuZ3VsYXInO1xuXG4vL2ltcG9ydCAqIGFzIHNtYXJ0RmFjdG9yeURlY29yYXRvciBmcm9tICcuL2NvbmZpZ0RlY29yYXRvcic7XG5cbm1vZHVsZSBzbWFydEZhY3Rvcnkge1xuXG4gIGV4cG9ydCBmdW5jdGlvbiBjb25maWcoZmFjdG9yeU5hbWU6IHN0cmluZykge1xuICAgIHJldHVybiAodGFyZ2V0OiBhbnkpID0+IHtcbiAgICAgICg8c21hcnRGYWN0b3J5LklDb25zdHJ1Y3RvcldpdGhGYWN0b3J5PnRhcmdldCkuX19yb3NpZUZhY3RvcnlOYW1lX18gPSBmYWN0b3J5TmFtZTtcblxuICAgICAgKDxzbWFydEZhY3RvcnkuSUNvbnN0cnVjdG9yV2l0aEZhY3Rvcnk+dGFyZ2V0KS5mYWN0b3J5ID0ge1xuICAgICAgICBsaXN0OiBmdW5jdGlvbihzaXplOiBudW1iZXIsIG92ZXJyaWRlT2JqPzogT2JqZWN0KSB7XG4gICAgICAgICAgcmV0dXJuIEZhY3RvcnkuYnVpbGRMaXN0KHRhcmdldC5fX3Jvc2llRmFjdG9yeU5hbWVfXywgc2l6ZSwgb3ZlcnJpZGVPYmopO1xuICAgICAgICB9LFxuICAgICAgICBidWlsZDogZnVuY3Rpb24ob3ZlcnJpZGVPYmo/OiBPYmplY3QpIHtcbiAgICAgICAgICByZXR1cm4gRmFjdG9yeS5idWlsZCh0YXJnZXQuX19yb3NpZUZhY3RvcnlOYW1lX18sIG92ZXJyaWRlT2JqKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9O1xuICB9XG5cbiAgZXhwb3J0IGludGVyZmFjZSBGYWN0b3J5RmFjaWxpdGllcyB7XG4gICAgbGlzdChzaXplOiBudW1iZXIsIG92ZXJyaWRlT2JqPzogT2JqZWN0KTtcbiAgICBidWlsZChvdmVycmlkZU9iaj86IE9iamVjdCk7XG4gIH1cblxuICBleHBvcnQgaW50ZXJmYWNlIElDb25zdHJ1Y3RvcldpdGhGYWN0b3J5IHtcbiAgICBfX3Jvc2llRmFjdG9yeU5hbWVfXzogc3RyaW5nO1xuICAgIGZhY3Rvcnk6IGFueTtcbiAgfVxuXG4gIGV4cG9ydCBjbGFzcyBGYWtlcldyYXBwZXIge1xuICAgIHN0YXRpYyBmYWtlcjogYW55ID0gZmFrZXI7XG5cblxuXG4gICAgcHVibGljIHN0YXRpYyBmaW5kTmFtZSgpOiBzdHJpbmcge1xuICAgICAgcmV0dXJuIHRoaXMuZmFrZXIubmFtZS5maW5kTmFtZSgpO1xuICAgIH1cbiAgfVxuXG4gIGV4cG9ydCBjbGFzcyBGYWN0b3J5V3JhcHBlciB7XG4gICAgc3RhdGljIGZhY3Rvcnk6IGFueSA9IEZhY3Rvcnk7XG5cbiAgICB3cmFwcGVkRmFjdG9yeTogYW55O1xuICAgIG5hbWU6IHN0cmluZztcblxuXG4gICAgcHVibGljIHN0YXRpYyBkZWZpbmUobmFtZTogU3RyaW5nLCBjb25zdHJ1Y3Rvcj86IEZ1bmN0aW9uKTogIEZhY3RvcnlXcmFwcGVye1xuICAgICAgdmFyIGZhYzogRmFjdG9yeVdyYXBwZXIgPSAgbmV3IEZhY3RvcnlXcmFwcGVyKCk7XG4gICAgICBmYWMud3JhcHBlZEZhY3RvcnkgPSA8RmFjdG9yeVdyYXBwZXI+dGhpcy5mYWN0b3J5LmRlZmluZShuYW1lLCBjb25zdHJ1Y3Rvcik7XG4gICAgICByZXR1cm4gZmFjO1xuICAgIH1cblxuICAgIHB1YmxpYyBzdGF0aWMgYnVpbGQobmFtZTogc3RyaW5nLCBhdHRyaWJ1dGVzPzogYW55W10sIG9wdGlvbnM/OiBPYmplY3QpOiBPYmplY3Qge1xuICAgICAgcmV0dXJuIHRoaXMuZmFjdG9yeS5idWlsZChuYW1lLCBhdHRyaWJ1dGVzLCBvcHRpb25zKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc3RhdGljIGJ1aWxkTGlzdChuYW1lOiBzdHJpbmcsIHNpemU6IG51bWJlciwgYXR0cmlidXRlcz86IGFueVtdLCBvcHRpb25zPzogT2JqZWN0KTogT2JqZWN0W10ge1xuICAgICAgcmV0dXJuIHRoaXMuZmFjdG9yeS5idWlsZChuYW1lLCBzaXplLCBhdHRyaWJ1dGVzLCBvcHRpb25zKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc3RhdGljIGF0dHJpYnV0ZXMoYXR0cmlidXRlczogT2JqZWN0LCBvcHRpb25zPzogT2JqZWN0KTogT2JqZWN0IHtcbiAgICAgIHJldHVybiB0aGlzLmZhY3RvcnkuYXR0cmlidXRlcyhhdHRyaWJ1dGVzLCBvcHRpb25zKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc3RhdGljIG9wdGlvbnMob3B0aW9uczogT2JqZWN0KTogT2JqZWN0IHtcbiAgICAgIHJldHVybiB0aGlzLmZhY3Rvcnkub3B0aW9ucyhvcHRpb25zKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc3RhdGljIGV4dGVuZChuYW1lOiBzdHJpbmcpe1xuICAgICAgcmV0dXJuIHRoaXMuZmFjdG9yeS5leHRlbmQobmFtZSk7XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyBmb3IodGFyZ2V0OiBhbnkpIDogRmFjdG9yeUZhY2lsaXRpZXMge1xuICAgICAgaWYoKCg8YW55PnRhcmdldCkuX19yb3NpZUZhY3RvcnlOYW1lX18pICYmICAoKDxhbnk+dGFyZ2V0KS5mYWN0b3J5KSkge1xuICAgICAgICByZXR1cm4gKDxzbWFydEZhY3RvcnkuSUNvbnN0cnVjdG9yV2l0aEZhY3Rvcnk+KDxhbnk+dGFyZ2V0KSkuZmFjdG9yeTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignbm8gZmFjdG9yeSByZWdpc3RlcmVkIGZvciAnICsgdGFyZ2V0LnRvU3RyaW5nKCkgKyAnIHBsZWFzZSBjaGVjayEnKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBhdHRyKG5hbWU6IHN0cmluZywgZGVwZW5kZW5jaWVzT3JWYWx1ZTogYW55IHwgc3RyaW5nW10sIHZhbHVlPzogYW55KTogRmFjdG9yeVdyYXBwZXIge1xuICAgICAgaWYoZGVwZW5kZW5jaWVzT3JWYWx1ZSAmJiBkZXBlbmRlbmNpZXNPclZhbHVlLmNvbnN0cnVjdG9yID09PSBBcnJheSl7XG4gICAgICAgIHRoaXMud3JhcHBlZEZhY3RvcnkgPSAoPEZhY3RvcnlXcmFwcGVyPnRoaXMud3JhcHBlZEZhY3RvcnkpLmF0dHIobmFtZSwgZGVwZW5kZW5jaWVzT3JWYWx1ZSwgdmFsdWUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy53cmFwcGVkRmFjdG9yeSA9ICg8RmFjdG9yeVdyYXBwZXI+dGhpcy53cmFwcGVkRmFjdG9yeSkuYXR0cihuYW1lLCBbXSwgZGVwZW5kZW5jaWVzT3JWYWx1ZSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIHNlcXVlbmNlKG5hbWU6IHN0cmluZywgZGVwZW5kZW5jaWVzPzogc3RyaW5nW10sIGJ1aWxkZXI/OiBGdW5jdGlvbikgOiBGYWN0b3J5V3JhcHBlciB7XG4gICAgICBpZiAoZGVwZW5kZW5jaWVzID09PSB1bmRlZmluZWQgJiYgYnVpbGRlciA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRoaXMud3JhcHBlZEZhY3RvcnkgPSAoPEZhY3RvcnlXcmFwcGVyPnRoaXMud3JhcHBlZEZhY3RvcnkpLnNlcXVlbmNlKG5hbWUpO1xuICAgICAgfSBlbHNlIGlmKGRlcGVuZGVuY2llcyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRoaXMud3JhcHBlZEZhY3RvcnkgPSAoPEZhY3RvcnlXcmFwcGVyPnRoaXMud3JhcHBlZEZhY3RvcnkpLnNlcXVlbmNlKG5hbWUsIFtdLCBidWlsZGVyIHx8IG51bGwpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy53cmFwcGVkRmFjdG9yeSA9ICg8RmFjdG9yeVdyYXBwZXI+dGhpcy53cmFwcGVkRmFjdG9yeSkuc2VxdWVuY2UobmFtZSwgZGVwZW5kZW5jaWVzLCBidWlsZGVyIHx8IG51bGwpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gIH1cblxuICBleHBvcnQgY2xhc3MgU2VydmljZSB7XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgIHJldHVybiBGYWN0b3J5V3JhcHBlcjtcbiAgICB9XG5cblxuXG4gIH1cblxufVxuXG5pZiAoKHR5cGVvZihhbmd1bGFyKSAhPSAndW5kZWZpbmVkJykpIHtcbiAgYW5ndWxhci5tb2R1bGUoJ3NtYXJ0RmFjdG9yeScsIFtdKS5zZXJ2aWNlKCdGYWN0b3J5Jywgc21hcnRGYWN0b3J5LlNlcnZpY2UpO1xufSBlbHNlIHtcbiAgaWYoY29uc29sZSAmJiBjb25zb2xlLmVycm9yKXtcbiAgICBpZih0eXBlb2YoYW5ndWxhcikgPT0gJ3VuZGVmaW5lZCcpe1xuICAgICAgICBjb25zb2xlLmVycm9yKCdzbWFydEZhY3Rvcnkgbm90IHJlZ2lzdGVyZWQgYmVhY3VzZSBhbmd1bGFyIGlzIG1pc3NpbmcnKTtcbiAgICB9XG4gICAgaWYodHlwZW9mKGZha2VyKSA9PSAndW5kZWZpbmVkJyl7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ3NtYXJ0RmFjdG9yeSBub3QgcmVnaXN0ZXJlZCBiZWFjdXNlIGZha2VyLmpzIGlzIG1pc3NpbmcnKTtcbiAgICB9XG4gICAgaWYodHlwZW9mKEZhY3RvcnkpID09ICd1bmRlZmluZWQnKXtcbiAgICAgICAgY29uc29sZS5lcnJvcignc21hcnRGYWN0b3J5IG5vdCByZWdpc3RlcmVkIGJlYWN1c2UgYW5ndWxhciByb3NpZSBpcyBtaXNzaW5nJyk7XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCA9IHNtYXJ0RmFjdG9yeTtcbiJdLCJzb3VyY2VSb290IjoiLi90cyJ9